{% extends "base.html" %}
{% load static %}
{% load form_tags %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/car-detail.css' %}">
{% endblock %}

{% block content %}

<div class="car-detail-container">
  <!-- Gallery Section -->
  <div class="car-gallery">
    <div class="carousel">
      {% if ordered_images %}
      {% for img in ordered_images %}
      <img src="{{ img.image.url }}" alt="{{ object.model }} - {{ object.brand }}" class="{% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}">
      {% endfor %}

      {% if ordered_images.count > 1 %}
      <button class="carousel-btn left" onclick="prevSlide()">
        <span class="material-symbols-outlined">chevron_left</span>
      </button>
      <button class="carousel-btn right" onclick="nextSlide()">
        <span class="material-symbols-outlined">chevron_right</span>
      </button>

      <div class="carousel-indicators">
        {% for img in ordered_images %}
        <button class="indicator {% if forloop.first %}active{% endif %}" onclick="showSlide({{ forloop.counter0 }})"></button>
        {% endfor %}
      </div>

      <div class="image-counter">
        <span id="current-image">1</span> / <span id="total-images">{{ ordered_images.count }}</span>
      </div>
      {% endif %}
      {% else %}
      <img src="{{ object.get_main_image }}" alt="foto indisponivel" class="active">
      {% endif %}
    </div>
  </div>

  <!-- Car Info Section -->
  <div class="car-info">
    <h1 class="car-title">{{ object.brand }} {{ object.model }}</h1>
    <div class="car-price">R$ {{ object.price|format_number }}</div>

    <div class="car-specs">
      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">calendar_today</span>
        </div>
        <div class="spec-content">
          <h4>Ano</h4>
          <p>{{ object.factory_year }}/{{ object.model_year }}</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">speed</span>
        </div>
        <div class="spec-content">
          <h4>Quilometragem</h4>
          <p>{{ object.mileage|format_number }} km</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">location_on</span>
        </div>
        <div class="spec-content">
          <h4>Localização</h4>
          <p>{{ object.state }}</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">palette</span>
        </div>
        <div class="spec-content">
          <h4>Cor</h4>
          <p>{{ object.color|default:"Não informado" }}</p>
        </div>
      </div>
    </div>

    {% if object.bio %}
    <div class="car-bio">
      <h3>Descrição</h3>
      <p>{{ object.bio }}</p>
    </div>
    {% endif %}

    <div class="action-buttons">
      <button class="btn-contact">
        <span class="material-symbols-outlined">call</span>
        Entrar em contato
      </button>

      <button class="btn-contact" style="background: #25d366;">
        <span class="material-symbols-outlined">chat</span>
        WhatsApp
      </button>
    </div>

    {% if user.is_authenticated %}
    <div class="admin-buttons">
      <a href="{% url 'car_update' pk=object.pk %}" class="btn-admin edit">
        <span class="material-symbols-outlined">edit</span>
        Editar
      </a>
      <a href="{% url 'car_delete' pk=object.pk %}" class="btn-admin delete">
        <span class="material-symbols-outlined">delete</span>
        Remover
      </a>
    </div>
    {% endif %}
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/carousel.js' %}"></script>
{% endblock %}