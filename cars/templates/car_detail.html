{% extends "base.html" %}

{% block content %}
<style>
  .car-detail-container {
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: 32px;
    max-width: 1200px;
    margin: 0 auto;
  }

  .car-gallery {
    background: var(--surface-color);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: var(--shadow-light);
  }

  .carousel {
    position: relative;
    width: 100%;
    aspect-ratio: 16/10;
    overflow: hidden;
    background: #f0f0f0;
  }

  .carousel img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
    transition: opacity 0.3s ease;
  }

  .carousel img.active {
    display: block;
  }

  .carousel-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.9);
    color: var(--text-primary);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    box-shadow: var(--shadow-light);
  }

  .carousel-btn:hover {
    background: white;
    box-shadow: var(--shadow-medium);
    transform: translateY(-50%) scale(1.05);
  }

  .carousel-btn.left {
    left: 16px;
  }

  .carousel-btn.right {
    right: 16px;
  }

  .carousel-indicators {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 8px;
  }

  .indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    border: none;
    background: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    transition: var(--transition);
  }

  .indicator.active {
    background: white;
    transform: scale(1.5);
  }

  .indicator:hover {
    background: rgba(255, 255, 255, 0.8);
  }

  .image-counter {
    position: absolute;
    top: 16px;
    right: 16px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    backdrop-filter: blur(10px);
  }

  .car-info {
    background: var(--surface-color);
    padding: 32px;
    border-radius: 16px;
    box-shadow: var(--shadow-light);
    height: fit-content;
    position: sticky;
    top: 88px;
  }

  .car-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
    line-height: 1.2;
  }

  .car-price {
    font-size: 32px;
    font-weight: 700;
    color: var(--secondary-color);
    margin-bottom: 24px;
  }

  .car-specs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 32px;
    width: 100%;
    box-sizing: border-box;
  }

  .spec-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--background-color);
    border-radius: var(--border-radius);
    min-width: 0;
    flex: 1;
    box-sizing: border-box;
  }

  .spec-icon {
    width: 40px;
    height: 40px;
    min-width: 40px;
    min-height: 40px;
    background: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .spec-icon .material-symbols-outlined {
    font-size: 20px;
    font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
  }

  .spec-content {
    min-width: 0;
    flex: 1;
  }

  .spec-content h4 {
    font-size: 12px;
    color: var(--text-secondary);
    margin: 0;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .spec-content p {
    font-size: 14px;
    color: var(--text-primary);
    margin: 0;
    font-weight: 600;
    word-break: break-word;
    overflow-wrap: break-word;
  }

  .car-bio {
    margin-bottom: 32px;
  }

  .car-bio h3 {
    font-size: 16px;
    color: var(--text-primary);
    margin-bottom: 12px;
    font-weight: 600;
  }

  .car-bio p {
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .btn-contact {
    background: var(--secondary-color);
    color: white;
    padding: 14px 20px;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .btn-contact:hover {
    background: #2d8f47;
    transform: translateY(-1px);
    box-shadow: var(--shadow-medium);
  }

  .admin-buttons {
    display: flex;
    gap: 12px;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid var(--border-color);
  }

  .btn-admin {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: white;
    color: var(--text-secondary);
    text-decoration: none;
    text-align: center;
    transition: var(--transition);
    font-weight: 500;
  }

  .btn-admin.edit:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    background: rgba(26, 115, 232, 0.05);
  }

  .btn-admin.delete:hover {
    border-color: #dc2626;
    color: #dc2626;
    background: rgba(220, 38, 38, 0.05);
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .car-detail-container {
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .car-info {
      position: static;
    }
  }

  @media (max-width: 768px) {
    .car-info {
      padding: 24px;
    }

    .car-title {
      font-size: 24px;
    }

    .car-price {
      font-size: 28px;
    }

    .car-specs {
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .spec-item {
      padding: 10px;
    }

    .spec-icon {
      width: 36px;
      height: 36px;
      min-width: 36px;
      min-height: 36px;
    }

    .spec-icon .material-symbols-outlined {
      font-size: 18px;
    }

    .carousel-btn {
      width: 36px;
      height: 36px;
      font-size: 16px;
    }

    .carousel-btn.left {
      left: 12px;
    }

    .carousel-btn.right {
      right: 12px;
    }


.car-card h2 {
font-size: 1.5rem;
margin: 10px;
}

.car-card p {
font-size: 1rem;
margin-bottom: 10px;
}

.buttons-container {
display: flex;
justify-content: center;
margin-top: 20px;
margin-bottom: 20px;
}

.btn {
display: inline-block;
background-color: #0096c7;
color: #fff;
border: none;
padding: 10px 20px;
font-size: 16px;
border-radius: 4px;
cursor: pointer;
transition: background-color 0.3s ease-in-out;
margin: 0 10px;
}

.btn:hover {
background-color: #108eb8;
}

.btn-danger {
background-color: #d9534f;
text-decoration: none !important;
}

.btn-danger:hover {
background-color: #d2221c;
}

a {
text-decoration: none !important;
}
</style>

<div class="car-detail-container">
  <!-- Gallery Section -->
  <div class="car-gallery">
    <div class="carousel">
      {% if ordered_images %}
      {% for img in ordered_images %}
      <img src="{{ img.image.url }}" alt="{{ object.model }} - {{ object.brand }}" class="{% if forloop.first %}active{% endif %}" data-slide="{{ forloop.counter0 }}">
      {% endfor %}

      {% if ordered_images.count > 1 %}
      <button class="carousel-btn left" onclick="prevSlide()">
        <span class="material-symbols-outlined">chevron_left</span>
      </button>
      <button class="carousel-btn right" onclick="nextSlide()">
        <span class="material-symbols-outlined">chevron_right</span>
      </button>

      <!-- Indicadores de slides -->
      <div class="carousel-indicators">
        {% for img in ordered_images %}
        <button class="indicator {% if forloop.first %}active{% endif %}" onclick="showSlide({{ forloop.counter0 }})"></button>
        {% endfor %}
      </div>

      <!-- Contador de imagens -->
      <div class="image-counter">
        <span id="current-image">1</span> / <span id="total-images">{{ ordered_images.count }}</span>
      </div>
      {% endif %}
      {% else %}
      <img src="{{ object.get_main_image }}" alt="foto indisponivel" class="active">
      {% endif %}
    </div>
  </div>

  <!-- Car Info Section -->
  <div class="car-info">
    <h1 class="car-title">{{ object.brand }} {{ object.model }}</h1>
    <div class="car-price">R$ {{ object.price | floatformat:0 }}</div>

    <div class="car-specs">
      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">calendar_today</span>
        </div>
        <div class="spec-content">
          <h4>Ano</h4>
          <p>{{ object.factory_year }}/{{ object.model_year }}</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">speed</span>
        </div>
        <div class="spec-content">
          <h4>Quilometragem</h4>
          <p>{{ object.mileage|floatformat:0 }} km</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">location_on</span>
        </div>
        <div class="spec-content">
          <h4>Localização</h4>
          <p>{{ object.state }}</p>
        </div>
      </div>

      <div class="spec-item">
        <div class="spec-icon">
          <span class="material-symbols-outlined">license</span>
        </div>
        <div class="spec-content">
          <h4>Placa</h4>
          <p>{{ object.plate|default:"Não informado" }}</p>
        </div>
      </div>
    </div>

    {% if object.bio %}
    <div class="car-bio">
      <h3>Descrição</h3>
      <p>{{ object.bio }}</p>
    </div>
    {% endif %}

    <div class="action-buttons">
      <button class="btn-contact">
        <span class="material-symbols-outlined">call</span>
        Entrar em contato
      </button>

      <button class="btn-contact" style="background: #25d366;">
        <span class="material-symbols-outlined">chat</span>
        WhatsApp
      </button>
    </div>

    {% if user.is_authenticated %}
    <div class="admin-buttons">
      <a href="{% url 'car_update' pk=object.pk %}" class="btn-admin edit">
        <span class="material-symbols-outlined">edit</span>
        Editar
      </a>
      <a href="{% url 'car_delete' pk=object.pk %}" class="btn-admin delete">
        <span class="material-symbols-outlined">delete</span>
        Remover
      </a>
    </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let currentSlide = 0;
    const slides = document.querySelectorAll(".carousel img");
    const indicators = document.querySelectorAll(".indicator");

    // Encontrar slide inicial (imagem principal ou primeira)
    const activeSlide = document.querySelector(".carousel img.active");
    if (activeSlide) {
      currentSlide = parseInt(activeSlide.getAttribute('data-slide')) || 0;
    }

    function updateSlide(index) {
      // Remove active de todos
      slides.forEach(slide => slide.classList.remove("active"));
      indicators.forEach(indicator => indicator.classList.remove("active"));

      // Adiciona active no atual
      if (slides[index]) {
        slides[index].classList.add("active");
      }
      if (indicators[index]) {
        indicators[index].classList.add("active");
      }

      // Atualiza contador
      const currentCounter = document.getElementById('current-image');
      if (currentCounter) {
        currentCounter.textContent = index + 1;
      }

      currentSlide = index;
    }

    window.showSlide = function (index) {
      if (index >= 0 && index < slides.length) {
        updateSlide(index);
      }
    };

    window.nextSlide = function () {
      const nextIndex = (currentSlide + 1) % slides.length;
      updateSlide(nextIndex);
    };

    window.prevSlide = function () {
      const prevIndex = (currentSlide - 1 + slides.length) % slides.length;
      updateSlide(prevIndex);
    };

    // Navegação por teclado (opcional)
    document.addEventListener('keydown', function (e) {
      if (slides.length > 1) {
        if (e.key === 'ArrowRight') nextSlide();
        if (e.key === 'ArrowLeft') prevSlide();
      }
    });

    // Auto-play (opcional - descomente se quiser)
    /*
    if (slides.length > 1) {
      setInterval(function() {
        nextSlide();
      }, 5000); // muda a cada 5 segundos
    }
    */
  });
</script>
{% endblock %}